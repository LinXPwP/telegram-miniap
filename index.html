<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>Telegram Shop MiniApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Telegram WebApp JS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root {
      --bg: #050509;
      --bg-card: #15151d;
      --accent: #e02424;
      --accent-soft: rgba(224, 36, 36, 0.18);
      --text: #f5f5f5;
      --muted: #a0a0b2;
      --border: #262634;
      --radius-xl: 18px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: radial-gradient(circle at top, #2b050f, #050509 50%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .app {
      width: 100%;
      max-width: 420px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.04);
      background: linear-gradient(145deg, rgba(255,255,255,0.02), rgba(0,0,0,0.6));
      padding: 18px 18px 20px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.7);
      backdrop-filter: blur(22px);
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 16px;
    }

    .logo {
      width: 42px;
      height: 42px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #ff5353, #7f1010 55%, #1a0000 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 20px;
      box-shadow: 0 10px 22px rgba(224,36,36,0.7);
    }

    .titles h1 {
      font-size: 19px;
      font-weight: 700;
      letter-spacing: 0.03em;
      margin-bottom: 4px;
    }

    .titles p {
      font-size: 12px;
      color: var(--muted);
    }

    .role-pill {
      padding: 6px 11px;
      border-radius: 999px;
      border: 1px solid var(--accent);
      background: var(--accent-soft);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    .role-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 10px rgba(224,36,36,1);
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      padding: 14px 14px 12px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
    }

    .card-sub {
      font-size: 12px;
      color: var(--muted);
    }

    .badge {
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 4px 9px;
      color: var(--muted);
    }

    .info-row {
      margin-top: 8px;
    }

    .info-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-bottom: 2px;
    }

    .info-value {
      font-size: 14px;
      font-weight: 500;
    }

    .info-value.credits {
      font-size: 18px;
      font-weight: 700;
      color: #ffffff;
    }

    .error {
      margin-top: 10px;
      font-size: 12px;
      color: #ff6b6b;
    }

    .footer {
      margin-top: 10px;
      font-size: 11px;
      color: var(--muted);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="logo">S</div>

      <div class="titles">
        <h1>Shop MiniApp</h1>
        <p id="subtitle">Se încarcă datele din Telegram...</p>
      </div>

      <div id="role-pill" class="role-pill" style="display:none;">
        <span class="role-dot"></span>
        <span id="role-text">User</span>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div>
          <div class="card-title">Profil & Credite</div>
          <div class="card-sub">Date citite în siguranță din bot</div>
        </div>
        <div id="user-id" class="badge">ID: -</div>
      </div>

      <div class="info-row">
        <div class="info-label">Username</div>
        <div id="username" class="info-value">loading...</div>
      </div>

      <div class="info-row">
        <div class="info-label">Status</div>
        <div id="status" class="info-value">loading...</div>
      </div>

      <div class="info-row">
        <div class="info-label">Credite disponibile</div>
        <div id="credits" class="info-value credits">loading...</div>
      </div>

      <div id="error" class="error" style="display:none;"></div>
    </div>

    <div class="footer">
      În pașii următori aici adăugăm: produse, categorii și sistemul de cumpărare.
    </div>
  </div>

  <script>
    (function () {
      const tg = window.Telegram.WebApp;
      if (tg && tg.expand) tg.expand();

      const subtitleEl = document.getElementById("subtitle");
      const usernameEl = document.getElementById("username");
      const statusEl = document.getElementById("status");
      const creditsEl = document.getElementById("credits");
      const userIdEl = document.getElementById("user-id");
      const errorEl = document.getElementById("error");
      const rolePillEl = document.getElementById("role-pill");
      const roleTextEl = document.getElementById("role-text");

      const ADMIN_ID = 7672256597;

      let user;
      try {
        user = tg.initDataUnsafe && tg.initDataUnsafe.user;
      } catch (e) {
        console.error(e);
      }

      if (!user) {
        subtitleEl.textContent = "MiniApp-ul trebuie deschis din Telegram.";
        usernameEl.textContent = "necunoscut";
        statusEl.textContent = "nu s-a putut citi utilizatorul";
        creditsEl.textContent = "–";
        errorEl.style.display = "block";
        errorEl.textContent = "Deschide acest miniapp din botul Telegram, nu din browser.";
        return;
      }

      const fullUsername = user.username ? "@" + user.username : "(fără username)";
      const fullName = [user.first_name || "", user.last_name || ""].join(" ").trim();

      usernameEl.textContent = fullUsername + (fullName ? " • " + fullName : "");
      userIdEl.textContent = "ID: " + user.id;

      const isAdmin = (user.id === ADMIN_ID);
      statusEl.textContent = isAdmin ? "Administrator" : "Utilizator normal";
      roleTextEl.textContent = isAdmin ? "ADMIN" : "USER";
      rolePillEl.style.display = "inline-flex";
      subtitleEl.textContent = "Datele sunt încărcate. Se iau creditele din bot...";

      // URL-ul Worker-ului tău Cloudflare (SCHIMBĂ AICI!)
      const WORKER_URL_BASE = "https://telegramshopminiapp.linx-discord22.workers.dev/";
      const url = WORKER_URL_BASE + "/get_credits?user_id=" + encodeURIComponent(user.id);

      fetch(url)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            throw new Error(data.error);
          }

          creditsEl.textContent = data.credits != null ? data.credits : 0;

          if (typeof data.is_admin === "boolean") {
            const adminFromApi = data.is_admin;
            statusEl.textContent = adminFromApi ? "Administrator" : "Utilizator normal";
            roleTextEl.textContent = adminFromApi ? "ADMIN" : "USER";
          }

          subtitleEl.textContent = "Conectat cu succes la bot. Creditele sunt actuale.";
        })
        .catch(err => {
          console.error("Eroare API:", err);
          creditsEl.textContent = "–";
          errorEl.style.display = "block";
          errorEl.textContent = "Nu s-au putut încărca creditele. Verifică Worker-ul / bot-ul.";
          subtitleEl.textContent = "Eroare la comunicarea cu API-ul.";
        });
    })();
  </script>
</body>
</html>
