<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard – Shop & Tichete</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root {
      --bg: #050509;
      --bg-card: #111111;
      --accent: #e50914;
      --accent-soft: #ff4b5c;
      --accent-muted: #8b0000;
      --text: #f5f5f5;
      --muted: #aaaaaa;
      --border: #222222;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #1a1a1a 0, #000 55%, #050509 100%);
      color: var(--text);
      min-height: 100vh;
    }

    .container {
      max-width: 720px;
      margin: 0 auto;
      padding: 16px 10px 22px;
    }

    .card {
      background: rgba(10, 10, 14, 0.96);
      border-radius: 18px;
      padding: 12px 12px 14px;
      border: 1px solid rgba(229, 9, 20, 0.5);
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      background: radial-gradient(
        circle at top left,
        var(--accent-soft),
        var(--accent)
      );
      color: #fff;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #fff;
    }

    h1 {
      margin: 4px 0 2px;
      font-size: 18px;
    }

    .subtitle {
      margin: 0 0 10px;
      font-size: 12px;
      color: var(--muted);
    }

    .user-line {
      font-size: 12px;
      margin-bottom: 10px;
      color: var(--muted);
    }

    .user-line b {
      color: var(--text);
    }

    .role-admin {
      color: var(--accent-soft);
      font-weight: 600;
    }

    .section-tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
      margin-top: 4px;
    }

    .tab-btn {
      flex: 1;
      font-size: 12px;
      padding: 6px 4px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #080808;
      color: var(--muted);
      cursor: pointer;
    }

    .tab-btn.active {
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
      color: #fff;
      border-color: transparent;
      font-weight: 600;
    }

    .tab-section {
      display: none;
    }
    .tab-section.active {
      display: block;
    }

    .section-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin: 4px 0 6px;
    }

    /* Tickets */

    .tickets-list {
      max-height: 320px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 6px;
      background: rgba(5, 5, 8, 0.8);
    }

    .ticket-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      padding: 4px 6px;
      border-radius: 8px;
      cursor: pointer;
    }

    .ticket-row:nth-child(odd) {
      background: rgba(255, 255, 255, 0.01);
    }

    .ticket-row.selected {
      background: rgba(229, 9, 20, 0.25);
      border: 1px solid rgba(229, 9, 20, 0.8);
    }

    .ticket-status-open {
      color: #ffc107;
    }
    .ticket-status-closed {
      color: #4caf50;
    }

    .ticket-details {
      margin-top: 8px;
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 8px;
      background: rgba(0, 0, 0, 0.6);
      font-size: 12px;
    }

    .ticket-details label {
      font-size: 11px;
      color: var(--muted);
    }

    .ticket-details textarea {
      width: 100%;
      min-height: 60px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #050505;
      color: var(--text);
      padding: 6px;
      font-size: 12px;
      resize: vertical;
    }

    .ticket-details select {
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #050505;
      color: var(--text);
      padding: 4px 8px;
      font-size: 12px;
    }

    .btn-primary {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
      color: #fff;
      cursor: pointer;
    }

    .btn-ghost {
      border-radius: 999px;
      padding: 5px 10px;
      border: 1px solid var(--border);
      background: #050505;
      font-size: 11px;
      color: var(--muted);
      cursor: pointer;
    }

    .status-bar {
      margin-top: 6px;
      font-size: 11px;
      min-height: 14px;
      color: var(--muted);
    }

    .status-ok {
      color: #4caf50;
    }

    .status-error {
      color: #ff5252;
    }

    /* Shop editor */

    .shop-container {
      max-height: 360px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 6px;
      background: rgba(5, 5, 8, 0.8);
    }

    .cat-card {
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 8px;
      margin-bottom: 6px;
      background: #090909;
    }

    .cat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .cat-header input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #050505;
      color: var(--text);
      padding: 5px 8px;
      font-size: 12px;
    }

    .cat-desc {
      margin-top: 4px;
    }
    .cat-desc textarea {
      width: 100%;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #050505;
      color: var(--text);
      padding: 5px;
      font-size: 12px;
      min-height: 40px;
      resize: vertical;
    }

    .products-list {
      margin-top: 6px;
      border-radius: 8px;
      border: 1px solid #202020;
      padding: 5px;
      background: #080808;
    }

    .product-row {
      display: grid;
      grid-template-columns: 1.5fr 0.7fr 0.7fr 0.7fr auto;
      gap: 4px;
      margin-bottom: 4px;
      align-items: center;
    }

    .product-row input {
      border-radius: 6px;
      border: 1px solid var(--border);
      background: #050505;
      color: var(--text);
      padding: 4px 5px;
      font-size: 11px;
      width: 100%;
    }

    .product-row label {
      display: block;
      font-size: 10px;
      color: var(--muted);
    }

    .product-mini-actions {
      display: flex;
      gap: 4px;
    }

    .small-input-label {
      font-size: 10px;
      color: var(--muted);
      margin-top: 2px;
    }

    .shop-actions {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    .footer {
      margin-top: 10px;
      font-size: 10px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .dot-red {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 10px var(--accent);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header-top">
        <div class="badge">
          <span class="badge-dot"></span>
          <span>Admin dashboard</span>
        </div>
        <div style="font-size: 11px; color: var(--muted);" id="envInfo">
          MiniApp Admin
        </div>
      </div>

      <h1>Panou administrator</h1>
      <p class="subtitle">
        Gestionezi tichetele de comenzi și structura shop-ului (categorii & produse),
        direct din MiniApp.
      </p>

      <p class="user-line" id="userLine">Verific utilizator...</p>

      <div class="section-tabs">
        <button class="tab-btn active" data-tab="ticketsTab">Tichete</button>
        <button class="tab-btn" data-tab="shopTab">Shop</button>
      </div>

      <!-- TICKETS TAB -->
      <div id="ticketsTab" class="tab-section active">
        <div class="section-title">Tichete clienți</div>
        <div class="tickets-list" id="ticketsList">
          <!-- tichete generate din JS -->
        </div>

        <div class="ticket-details" id="ticketDetails" style="display: none;">
          <div id="ticketSummary" style="margin-bottom: 6px;"></div>

          <div style="margin-bottom: 4px;">
            <label for="ticketStatusSelect">Status tichet:</label><br />
            <select id="ticketStatusSelect">
              <option value="open">Deschis</option>
              <option value="closed">Închis</option>
            </select>
          </div>

          <div>
            <label for="ticketNote">Notă / răspuns intern:</label><br />
            <textarea id="ticketNote"></textarea>
          </div>

          <div style="margin-top: 6px; display: flex; gap: 6px;">
            <button class="btn-primary" id="ticketSaveBtn">
              Salvează tichetul
            </button>
            <button class="btn-ghost" id="ticketCloseBtn">
              Închide tichetul
            </button>
          </div>

          <div class="status-bar" id="ticketStatusBar"></div>
        </div>
      </div>

      <!-- SHOP TAB -->
      <div id="shopTab" class="tab-section">
        <div class="section-title">Categorii & produse</div>
        <div class="shop-container" id="shopContainer">
          <!-- categorii generate din JS -->
        </div>

        <div class="shop-actions">
          <button class="btn-ghost" id="addCategoryBtn">+ Categorie</button>
          <button class="btn-primary" id="saveShopBtn">Salvează shop</button>
        </div>

        <div class="status-bar" id="shopStatusBar"></div>
      </div>

      <div class="footer">
        <span>v0.2 – admin panel</span>
        <span class="dot-red"></span>
      </div>
    </div>
  </div>

  <script>
    const API_URL =
      "https://dancing-hotteok-480e3c.netlify.app/.netlify/functions/api";
    const ADMIN_ID = 7672256597;

    const tg = window.Telegram?.WebApp;

    let CURRENT_USER = null;
    let ALL_TICKETS = [];
    let CURRENT_SHOP = null;
    let SELECTED_TICKET_ID = null;

    const userLineEl = document.getElementById("userLine");
    const ticketsListEl = document.getElementById("ticketsList");
    const ticketDetailsEl = document.getElementById("ticketDetails");
    const ticketSummaryEl = document.getElementById("ticketSummary");
    const ticketNoteEl = document.getElementById("ticketNote");
    const ticketStatusSelect = document.getElementById("ticketStatusSelect");
    const ticketStatusBarEl = document.getElementById("ticketStatusBar");

    const shopContainerEl = document.getElementById("shopContainer");
    const shopStatusBarEl = document.getElementById("shopStatusBar");

    const addCategoryBtn = document.getElementById("addCategoryBtn");
    const saveShopBtn = document.getElementById("saveShopBtn");
    const ticketSaveBtn = document.getElementById("ticketSaveBtn");
    const ticketCloseBtn = document.getElementById("ticketCloseBtn");

    // Tabs logic
    document.querySelectorAll(".tab-btn").forEach((btn) => {
      btn.addEventListener("click", () => {
        document
          .querySelectorAll(".tab-btn")
          .forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        const target = btn.getAttribute("data-tab");
        document
          .querySelectorAll(".tab-section")
          .forEach((s) => s.classList.remove("active"));
        document.getElementById(target).classList.add("active");
      });
    });

    // ============================
    // Helpers
    // ============================

    function apiCall(action, extraPayload = {}) {
      const payload = {
        action,
        user: CURRENT_USER,
        ...extraPayload,
      };
      return fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      }).then((r) => r.json());
    }

    function requireAdminOrStop() {
      if (!CURRENT_USER) {
        userLineEl.textContent = "Nu am date despre utilizator.";
        return false;
      }
      if (Number(CURRENT_USER.id) !== ADMIN_ID) {
        userLineEl.innerHTML =
          "<span style='color:#ff5252;'>Acces interzis.</span> Doar administratorul poate deschide acest panou.";
        return false;
      }
      return true;
    }

    function renderUserLine() {
      if (!CURRENT_USER) return;
      const name =
        CURRENT_USER.username && CURRENT_USER.username !== "fara_username"
          ? "@" + CURRENT_USER.username
          : `ID ${CURRENT_USER.id}`;

      userLineEl.innerHTML = `
        Autentificat ca: <b>${name}</b> ·
        <span class="role-admin">Administrator</span>
      `;
    }

    // ============================
    // Tickets
    // ============================

    function renderTicketsList() {
      ticketsListEl.innerHTML = "";
      if (!ALL_TICKETS || ALL_TICKETS.length === 0) {
        ticketsListEl.innerHTML =
          '<div style="font-size:12px; color:var(--muted);">Nu există tichete încă.</div>';
        ticketDetailsEl.style.display = "none";
        return;
      }

      ALL_TICKETS.sort((a, b) => {
        // cele deschise primele, apoi după dată (desc)
        if (a.status !== b.status) {
          return a.status === "open" ? -1 : 1;
        }
        return (b.id || 0) - (a.id || 0);
      });

      ALL_TICKETS.forEach((t) => {
        const row = document.createElement("div");
        row.className = "ticket-row";
        if (t.id === SELECTED_TICKET_ID) row.classList.add("selected");

        const left = document.createElement("div");
        left.style.flex = "1";

        const statusSpan = document.createElement("span");
        statusSpan.className =
          t.status === "open" ? "ticket-status-open" : "ticket-status-closed";
        statusSpan.textContent =
          t.status === "open" ? "● deschis" : "● închis";

        const mainLine = document.createElement("div");
        mainLine.innerHTML = `<b>${t.product_name || "Produs"}</b> · ${t.qty} buc.`;

        const subLine = document.createElement("div");
        subLine.style.fontSize = "11px";
        subLine.style.color = "var(--muted)";
        subLine.textContent =
          `User ${t.username || t.user_id} · ${t.created_at || ""}`;

        left.appendChild(mainLine);
        left.appendChild(subLine);

        const right = document.createElement("div");
        right.style.textAlign = "right";
        right.style.fontSize = "11px";
        right.innerHTML = `
          ${statusSpan.outerHTML}<br/>
          ${t.total_price} credite
        `;

        row.appendChild(left);
        row.appendChild(right);

        row.addEventListener("click", () => selectTicket(t.id));

        ticketsListEl.appendChild(row);
      });
    }

    function selectTicket(ticketId) {
      SELECTED_TICKET_ID = ticketId;
      const t = ALL_TICKETS.find((x) => x.id === ticketId);
      renderTicketsList();

      if (!t) {
        ticketDetailsEl.style.display = "none";
        return;
      }

      ticketDetailsEl.style.display = "block";
      ticketSummaryEl.innerHTML = `
        <b>Tichet #${t.id}</b><br/>
        De la: <b>${t.username || t.user_id}</b><br/>
        Produs: <b>${t.product_name}</b> (${t.qty} buc, total ${t.total_price} credite)
      `;
      ticketStatusSelect.value = t.status || "open";
      ticketNoteEl.value = t.note || "";
      ticketStatusBarEl.textContent = "";
      ticketStatusBarEl.className = "status-bar";
    }

    async function saveSelectedTicket(closed = false) {
      if (!SELECTED_TICKET_ID) return;
      const t = ALL_TICKETS.find((x) => x.id === SELECTED_TICKET_ID);
      if (!t) return;

      const newStatus = closed ? "closed" : ticketStatusSelect.value;
      const note = ticketNoteEl.value || "";

      ticketStatusBarEl.textContent = "Se salvează tichetul...";
      ticketStatusBarEl.className = "status-bar";

      try {
        const res = await apiCall("admin_update_ticket", {
          ticket_id: t.id,
          status: newStatus,
          note: note,
        });

        if (!res.ok) {
          ticketStatusBarEl.textContent =
            "Eroare la salvare: " + (res.error || "necunoscută");
          ticketStatusBarEl.className = "status-bar status-error";
          return;
        }

        // actualizăm local
        t.status = newStatus;
        t.note = note;

        ticketStatusBarEl.textContent = "Tichet salvat.";
        ticketStatusBarEl.className = "status-bar status-ok";

        renderTicketsList();
      } catch (err) {
        console.error("admin_update_ticket error:", err);
        ticketStatusBarEl.textContent =
          "Eroare la comunicarea cu serverul.";
        ticketStatusBarEl.className = "status-bar status-error";
      }
    }

    // ============================
    // Shop editor
    // ============================

    function renderShopEditor() {
      shopContainerEl.innerHTML = "";
      if (!CURRENT_SHOP || !CURRENT_SHOP.categories) {
        shopContainerEl.innerHTML =
          '<div style="font-size:12px; color:var(--muted);">Nu există categorii. Adaugă una nouă.</div>';
        return;
      }

      CURRENT_SHOP.categories.forEach((cat, catIndex) => {
        const catDiv = document.createElement("div");
        catDiv.className = "cat-card";

        // header
        const header = document.createElement("div");
        header.className = "cat-header";

        const nameInput = document.createElement("input");
        nameInput.placeholder = "Nume categorie";
        nameInput.value = cat.name || "";
        nameInput.addEventListener("input", () => {
          cat.name = nameInput.value;
        });

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn-ghost";
        deleteBtn.textContent = "Șterge";
        deleteBtn.style.fontSize = "11px";
        deleteBtn.onclick = () => {
          if (confirm("Sigur vrei să ștergi categoria?")) {
            CURRENT_SHOP.categories.splice(catIndex, 1);
            renderShopEditor();
          }
        };

        header.appendChild(nameInput);
        header.appendChild(deleteBtn);

        const descDiv = document.createElement("div");
        descDiv.className = "cat-desc";
        const descArea = document.createElement("textarea");
        descArea.placeholder = "Descriere categorie";
        descArea.value = cat.description || "";
        descArea.addEventListener("input", () => {
          cat.description = descArea.value;
        });
        descDiv.appendChild(descArea);

        const productsWrap = document.createElement("div");
        productsWrap.className = "products-list";

        (cat.products = cat.products || []).forEach((prod, prodIndex) => {
          const row = document.createElement("div");
          row.className = "product-row";

          // nume + descriere (în title)
          const colName = document.createElement("div");
          const nameInputProd = document.createElement("input");
          nameInputProd.placeholder = "Nume produs";
          nameInputProd.value = prod.name || "";
          nameInputProd.addEventListener("input", () => {
            prod.name = nameInputProd.value;
          });
          const nameLabel = document.createElement("div");
          nameLabel.className = "small-input-label";
          nameLabel.textContent = "Nume";

          colName.appendChild(nameInputProd);
          colName.appendChild(nameLabel);

          // preț
          const colPrice = document.createElement("div");
          const priceInput = document.createElement("input");
          priceInput.type = "number";
          priceInput.placeholder = "Preț";
          priceInput.value = prod.price || 0;
          priceInput.addEventListener("input", () => {
            prod.price = Number(priceInput.value || 0);
          });
          const priceLabel = document.createElement("div");
          priceLabel.className = "small-input-label";
          priceLabel.textContent = "Preț";

          colPrice.appendChild(priceInput);
          colPrice.appendChild(priceLabel);

          // min_qty
          const colMin = document.createElement("div");
          const minInput = document.createElement("input");
          minInput.type = "number";
          minInput.placeholder = "Min";
          minInput.value = prod.min_qty || 1;
          minInput.addEventListener("input", () => {
            prod.min_qty = Number(minInput.value || 1);
          });
          const minLabel = document.createElement("div");
          minLabel.className = "small-input-label";
          minLabel.textContent = "Min";

          colMin.appendChild(minInput);
          colMin.appendChild(minLabel);

          // max_qty
          const colMax = document.createElement("div");
          const maxInput = document.createElement("input");
          maxInput.type = "number";
          maxInput.placeholder = "Max";
          maxInput.value = prod.max_qty || prod.min_qty || 1;
          maxInput.addEventListener("input", () => {
            prod.max_qty = Number(maxInput.value || prod.min_qty || 1);
          });
          const maxLabel = document.createElement("div");
          maxLabel.className = "small-input-label";
          maxLabel.textContent = "Max";

          colMax.appendChild(maxInput);
          colMax.appendChild(maxLabel);

          // acțiuni
          const colActions = document.createElement("div");
          colActions.className = "product-mini-actions";
          const delProdBtn = document.createElement("button");
          delProdBtn.className = "btn-ghost";
          delProdBtn.style.fontSize = "10px";
          delProdBtn.textContent = "X";
          delProdBtn.onclick = () => {
            if (confirm("Ștergi produsul?")) {
              cat.products.splice(prodIndex, 1);
              renderShopEditor();
            }
          };

          colActions.appendChild(delProdBtn);

          row.appendChild(colName);
          row.appendChild(colPrice);
          row.appendChild(colMin);
          row.appendChild(colMax);
          row.appendChild(colActions);

          productsWrap.appendChild(row);

          // descriere sub rând (opțional)
          const descRow = document.createElement("div");
          descRow.style.gridColumn = "1 / -1";
          descRow.style.marginBottom = "4px";
          const descInput = document.createElement("input");
          descInput.placeholder = "Descriere produs";
          descInput.value = prod.description || "";
          descInput.addEventListener("input", () => {
            prod.description = descInput.value;
          });
          descRow.appendChild(descInput);
          productsWrap.appendChild(descRow);
        });

        // buton adăugare produs
        const addProdBtn = document.createElement("button");
        addProdBtn.className = "btn-ghost";
        addProdBtn.style.fontSize = "11px";
        addProdBtn.textContent = "+ Produs";
        addProdBtn.onclick = () => {
          cat.products.push({
            id: "prod_" + Date.now(),
            name: "Produs nou",
            price: 0,
            description: "",
            min_qty: 1,
            max_qty: 1,
          });
          renderShopEditor();
        };

        productsWrap.appendChild(addProdBtn);

        catDiv.appendChild(header);
        catDiv.appendChild(descDiv);
        catDiv.appendChild(productsWrap);

        shopContainerEl.appendChild(catDiv);
      });
    }

    async function saveShop() {
      if (!CURRENT_SHOP) return;
      shopStatusBarEl.textContent = "Se salvează shop-ul...";
      shopStatusBarEl.className = "status-bar";

      try {
        const res = await apiCall("admin_save_shop", { shop: CURRENT_SHOP });
        if (!res.ok) {
          shopStatusBarEl.textContent =
            "Eroare la salvare: " + (res.error || "necunoscută");
          shopStatusBarEl.className = "status-bar status-error";
          return;
        }
        shopStatusBarEl.textContent = "Shop salvat.";
        shopStatusBarEl.className = "status-bar status-ok";
      } catch (err) {
        console.error("admin_save_shop error:", err);
        shopStatusBarEl.textContent = "Eroare la comunicarea cu serverul.";
        shopStatusBarEl.className = "status-bar status-error";
      }
    }

    function addCategory() {
      if (!CURRENT_SHOP) CURRENT_SHOP = { categories: [] };
      CURRENT_SHOP.categories.push({
        id: "cat_" + Date.now(),
        name: "Categorie nouă",
        description: "",
        products: [],
      });
      renderShopEditor();
    }

    // ============================
    // INIT
    // ============================

    async function initAdmin() {
      if (!tg) {
        userLineEl.textContent =
          "Nu ești în Telegram MiniApp. Deschide admin.html prin WebApp la bot.";
        return;
      }

      tg.ready();
      tg.expand();

      const u = tg.initDataUnsafe?.user;
      if (!u) {
        userLineEl.textContent =
          "Telegram nu a trimis datele userului. Deschide din bot.";
        return;
      }

      CURRENT_USER = {
        id: u.id,
        username: u.username || null,
        first_name: u.first_name || null,
        last_name: u.last_name || null,
      };

      if (!requireAdminOrStop()) {
        return;
      }

      renderUserLine();

      try {
        const res = await apiCall("admin_get_tickets", {});
        console.log("admin_get_tickets:", res);

        if (!res.ok) {
          userLineEl.innerHTML =
            "<span style='color:#ff5252;'>Eroare API:</span> " +
            (res.error || "necunoscută");
          return;
        }

        ALL_TICKETS = res.tickets || [];
        CURRENT_SHOP = res.shop || { categories: [] };

        renderTicketsList();
        renderShopEditor();
      } catch (err) {
        console.error("admin_get_tickets error:", err);
        userLineEl.innerHTML =
          "<span style='color:#ff5252;'>Eroare la rețea.</span>";
      }
    }

    // Events
    ticketSaveBtn.addEventListener("click", () => saveSelectedTicket(false));
    ticketCloseBtn.addEventListener("click", () => saveSelectedTicket(true));
    addCategoryBtn.addEventListener("click", addCategory);
    saveShopBtn.addEventListener("click", saveShop);

    initAdmin();
  </script>
</body>
</html>
